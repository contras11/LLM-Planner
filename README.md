# Jules' Calendar - 高機能インタラクティブカレンダー

[![ko-fi](https://ko-fi.com/img/githubbutton_sm.svg)](https://ko-fi.com/Y8Y3WJ2E1)

![月ビュー](https://user-images.githubusercontent.com/12345/screenshot_month_view.png)
_（月ビューのスクリーンショット例）_

![週ビュー](https://user-images.githubusercontent.com/12345/screenshot_week_view.png)
_（週ビューのスクリーンショット例。イベントはドラッグ＆ドロップで直感的に操作可能）_

---

`Jules' Calendar` は、**Dash** と **Dash Bootstrap Components** で構築された、モダンでインタラクティブなカレンダーWebアプリケーションです。
単なる表示だけでなく、**ドラッグ＆ドロップによるイベント編集**、**自然言語でのイベント追加**、**コミットメントレベルに応じた色分け**など、実用的な機能を多数搭載しています。

## ✨ 主な特徴

- **月・週ビューの動的切り替え**
  - **月ビュー**: イベントの概要をバッジで表示。日付をクリックするとその週のビューにジャンプ。
  - **週ビュー**: 時間軸に沿ってイベントバーを配置。視覚的に空き時間を確認可能。

- **直感的なイベント操作 (Drag & Drop)**
  - **ドラッグで移動**: イベントバーを掴んで別の時間や日付に移動。
  - **リサイズで期間変更**: バーの下辺をドラッグしてイベントの所要時間を変更。
  - これらの操作は**クライアントサイドJavaScript**で実装されており、サーバーとの通信なしに軽快に動作します。変更が確定した時点で、コールバック経由でデータが更新されます。

- **自然言語 (LLM) によるイベント作成**
  - `「デザインレビュー」を明日の15時から90分、セカンダリで` のようなテキスト入力で、イベントの「タイトル」「日時」「所要時間」「コミットメント」を自動解析し、モーダルに設定します。
  - （現在は正規表現ベースの `dummy_llm_api` ですが、外部LLM APIとの連携も容易です。）

- **コミットメント管理**
  - `Primary`, `Secondary`, `Observer`, `Tentative` の4段階でイベントの重要度を管理。
  - コミットメントごとに色分けされ、週ビューでの視認性を高めます。

- **スマートなイベントレイアウト**
  - 週ビューで同じ時間帯に複数のイベントが重なる場合でも、**自動でレーンを割り当てて表示**。イベントが隠れることなく、すべての予定を把握できます。

- **柔軟な設計**
  - タイムゾーン設定、表示時間帯、コミットメントの色分けなど、多くの要素が `app.py` 上部で簡単にカスタマイズ可能です。

## 🛠️ 技術スタック

- **Backend**: [Dash](https://dash.plotly.com/) (Plotly)
- **Frontend**: [Dash Bootstrap Components](https://dash-bootstrap-components.opensource.faculty.ai/), Custom JavaScript
- **Data Handling**: [pandas](https://pandas.pydata.org/)
- **Timezone**: [pytz](https://pythonhosted.org/pytz/)
- **Web Server**: [Gunicorn](https://gunicorn.org/) (本番環境用)

## 🚀 セットアップと実行

1.  **リポジトリをクローン:**
    ```bash
    git clone https://github.com/your-username/jules-calendar.git
    cd jules-calendar
    ```

2.  **必要なパッケージをインストール:**
    `requirements.txt` に記載された依存関係をインストールします。
    ```bash
    pip install -r requirements.txt
    ```

3.  **開発サーバーで実行:**
    ```bash
    python app.py
    ```
    デフォルトで `http://127.0.0.1:8050` でアプリケーションが起動します。

4.  **本番環境での実行 (Gunicorn):**
    `gunicorn` を使って、より堅牢なWebサーバーとして実行することも可能です。
    ```bash
    gunicorn -w 4 'app:app.server'
    ```

## 使い方

- **ビューの切り替え**: 画面上部の「Month」「Week」ボタンで表示を切り替えます。
- **イベントの追加**:
  - 週ビューのカラム下部にある `+` ボタンをクリック。
  - 月ビューの日付セルをクリック。
  - 画面下部の自然言語入力ボックスにテキストを入力し、「Create」ボタンを押す。
- **イベントの編集**:
  - 週ビューのイベントバーをドラッグ＆ドロップ、またはリサイズする。
  - （将来的には、バーのクリックで編集モーダルを開く機能も追加予定です。）
- **イベントの削除**:
  - （現在はUIからの削除機能はありません。`events_init` から手動で削除するか、編集機能で上書きしてください。）

## ⚙️ 設定のカスタマイズ

`app.py` の冒頭にある以下の定数を変更することで、アプリケーションの挙動をカスタマイズできます。

- `TZ`: 使用するタイムゾーン (`pytz.timezone('Asia/Tokyo')`)
- `START_H`, `END_H`: 週ビューで表示する時間帯 (例: `8`時から`20`時)
- `GRID_CELL_MIN`: イベントを配置する時間グリッドの最小単位（分）
- `COMMIT_COLORS`: コミットメントレベルごとの背景色と文字色

## 🏗️ コードの構造

このアプリケーションは、単一のファイル `app.py` で構成されています。

- **設定**: ファイル冒頭の定数群。
- **サンプルデータ**: `events_init` に初期表示用のイベントデータが定義されています。
- **ヘルパー関数**:
  - `generate_month_view`, `generate_week_bars`: 月・週ビューのHTMLコンポーネントを生成します。
  - `assign_lanes`: 週ビューでイベントが重ならないようにレーンを割り当てるロジックです。
  - `dummy_llm_api`: 自然言語をパースしてイベント情報を抽出します。
- **Dashレイアウト**: `app.layout` がアプリケーション全体のHTML構造を定義しています。`dcc.Store` を使ってイベントデータやUIの状態を管理します。
- **クライアントサイドJavaScript**: `html.Script` 内に埋め込まれたJavaScriptコード。ドラッグ＆ドロップ、リサイズ、ツールチップ表示などのインタラクティブな操作を担います。
- **Dashコールバック**: `@app.callback` デコレータで定義された関数群。ユーザー操作（ボタンクリック、ビュー切り替え、ドラッグ完了など）に応じてサーバーサイドの処理を実行し、UIを更新します。

## ライセンス

このプロジェクトはMITライセンスです。詳細は `LICENSE` ファイルをご覧ください。

---

ご意見や改善提案、機能追加の要望などがあれば、ぜひIssueでお知らせください。
